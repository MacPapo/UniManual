<!doctype html>
<html lang="en">
<head>
<title>Array</title>
<!-- 2022-01-21 Fri 12:48 -->
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="generator" content="Org-mode">
<meta name="author" content="Jacopo Costantini">

<link  href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/css/bootstrap.min.css" rel="stylesheet">
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.5/js/bootstrap.min.js"></script>
<style>
/* org mode styles on top of twbs */

html {
    position: relative;
    min-height: 100%;
}

body {
    font-size: 18px;
    margin-bottom: 105px;
}

footer {
    position: absolute;
    bottom: 0;
    width: 100%;
    height: 101px;
    background-color: #f5f5f5;
}

footer > div {
    padding: 10px;
}

footer p {
    margin: 0 0 5px;
    text-align: center;
    font-size: 16px;
}

#table-of-contents {
    margin-top: 20px;
    margin-bottom: 20px;
}

blockquote p {
    font-size: 18px;
}

pre {
    font-size: 16px;
}

.footpara {
    display: inline-block;
}

figcaption {
  font-size: 16px;
  color: #666;
  font-style: italic;
  padding-bottom: 15px;
}

/* from twbs docs */

.bs-docs-sidebar.affix {
    position: static;
}
@media (min-width: 768px) {
    .bs-docs-sidebar {
        padding-left: 20px;
    }
}

/* All levels of nav */
.bs-docs-sidebar .nav > li > a {
    display: block;
    padding: 4px 20px;
    font-size: 14px;
    font-weight: 500;
    color: #999;
}
.bs-docs-sidebar .nav > li > a:hover,
.bs-docs-sidebar .nav > li > a:focus {
    padding-left: 19px;
    color: #A1283B;
    text-decoration: none;
    background-color: transparent;
    border-left: 1px solid #A1283B;
}
.bs-docs-sidebar .nav > .active > a,
.bs-docs-sidebar .nav > .active:hover > a,
.bs-docs-sidebar .nav > .active:focus > a {
    padding-left: 18px;
    font-weight: bold;
    color: #A1283B;
    background-color: transparent;
    border-left: 2px solid #A1283B;
}

/* Nav: second level (shown on .active) */
.bs-docs-sidebar .nav .nav {
    display: none; /* Hide by default, but at >768px, show it */
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 30px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav > li > a:focus {
    padding-left: 29px;
}
.bs-docs-sidebar .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav > .active:focus > a {
    padding-left: 28px;
    font-weight: 500;
}

/* Nav: third level (shown on .active) */
.bs-docs-sidebar .nav .nav .nav {
    padding-bottom: 10px;
}
.bs-docs-sidebar .nav .nav .nav > li > a {
    padding-top: 1px;
    padding-bottom: 1px;
    padding-left: 40px;
    font-size: 12px;
    font-weight: normal;
}
.bs-docs-sidebar .nav .nav .nav > li > a:hover,
.bs-docs-sidebar .nav .nav .nav > li > a:focus {
    padding-left: 39px;
}
.bs-docs-sidebar .nav .nav .nav > .active > a,
.bs-docs-sidebar .nav .nav .nav > .active:hover > a,
.bs-docs-sidebar .nav .nav .nav > .active:focus > a {
    padding-left: 38px;
    font-weight: 500;
}

/* Show and affix the side nav when space allows it */
@media (min-width: 992px) {
    .bs-docs-sidebar .nav > .active > ul {
        display: block;
    }
    /* Widen the fixed sidebar */
    .bs-docs-sidebar.affix,
    .bs-docs-sidebar.affix-bottom {
        width: 213px;
    }
    .bs-docs-sidebar.affix {
        position: fixed; /* Undo the static from mobile first approach */
        top: 20px;
    }
    .bs-docs-sidebar.affix-bottom {
        position: absolute; /* Undo the static from mobile first approach */
    }
    .bs-docs-sidebar.affix .bs-docs-sidenav,.bs-docs-sidebar.affix-bottom .bs-docs-sidenav {
        margin-top: 0;
        margin-bottom: 0
    }
}
@media (min-width: 1200px) {
    /* Widen the fixed sidebar again */
    .bs-docs-sidebar.affix-bottom,
    .bs-docs-sidebar.affix {
        width: 263px;
    }
}
</style>
<script>
$(function() {
    'use strict';

    $('.bs-docs-sidebar li').first().addClass('active');

    $(document.body).scrollspy({target: '.bs-docs-sidebar'});

    $('.bs-docs-sidebar').affix();
});
</script>

<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  displayAlign: "center",
  displayIndent: "2em",
  messageStyle: "none",
  "HTML-CSS": {
    scale: 100,
    styles: {
      ".MathJax_Display": {
        "font-size": "100%"
      }
    }
  },
  "SVG": {
    scale: 100,
    styles: {
      ".MathJax_SVG_Display": {
        "font-size": "100%",
        "margin-left": "-2.281em"
      }
    }
  }
});
</script>
<script src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_SVG"></script>
</head>
<body>
<div id="content" class="container">
<div class="row"><div class="col-md-3 col-md-push-9"><nav id="table-of-contents">
<div id="text-table-of-contents" class="bs-docs-sidebar">
<ul class="nav">
<li><a href="#sec-1">1. Creazione di un array</a></li>
<li><a href="#sec-2">2. Come accedere agli elementi di un array</a></li>
<li><a href="#sec-3">3. Conversione implicita al tipo puntatore</a></li>
<li><a href="#sec-4">4. Aritmetica dei puntatori</a></li>
<li><a href="#sec-5">5. Iterare gli elementi di un array</a></li>
<li><a href="#sec-6">6. Memoria Dinamica</a>
<ul class="nav">
<li><a href="#sec-6-1">6.1. Esercizio: Scrivere una funzione che dato un vettore, genera un nuovo vettore con gli stessi elementi in ordine inverso.</a></li>
</ul>
</li>
<li><a href="#sec-7">7. Array Multi-dimensionale</a></li>
</ul>
</div>
</nav>
</div><div class="col-md-9 col-md-pull-3"><h1 class="title">Array</h1>
<blockquote>
<p>
Un <b>array</b> è una sequenza congiunta di valori/&ldquo;oggetti&rdquo;/informazioni dello stesso tipo.
</p>
</blockquote>

<p>
Dato un tipo X, è possibile costruire un array di valori di tipo X specificando il numero di elementi desiderati. Il tipo X può essere un tipo primitivo come <b>int, double, char,ecc..</b> oppure un tipo definito dall&rsquo;utente.
</p>

<p>
Un array ha le seguenti proprietà:
</p>

<ul class="org-ul">
<li>Ha una <b>dimensione fissa</b> (numero di elementi), definita al momento della creazione dell&rsquo;array e non può essere modificata nel corso del programma
</li>
<li>Un array ha tutti gli elementi dello <b>stesso tipo</b>
</li>
<li>Gli elementi sono memorizzati in <b>locazioni contigue</b> di memoria
</li>
<li>Accedere ad un elemento di un array richiede <b>tempo costante</b> indipendentemente dalla sua posizione
</li>
</ul>

<div id="outline-container-sec-1" class="outline-2">
<h2 id="sec-1"><span class="section-number-2">1</span> Creazione di un array</h2>
<div class="outline-text-2" id="text-1">
<p>
Un array di interi, ad esempio, può essere dichiarato (creato) così:
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">my_array</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span>;
</pre>
</div>

<p>
In ANSI C, la dimensione deve essere costante di tipo int. Il motivo è che la dimensione deve essere nota al momento della compilazione del codice. ANSI C è molto restrittivo e, al contrario di altri linguaggi, <i>non</i> consente nemmeno una dichiarazione come la seguente:
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">N</span> = <span style="color: #465953; background-color: #d2ebe3;">10</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">my_array</span><span style="color: #7382a0;">[</span>N<span style="color: #7382a0;">]</span>;
</pre>
</div>

<p>
La ragione è che, essendo N una variabile, il compilatore non la considera una costante e non ne permette l&rsquo;uso come dimensione di un array. E possibile specificare alcuni o tutti i valori contenuti di un array al momento della creazione:
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">f</span><span style="color: #7382a0;">()</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span>;           <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">valori non inizializzati</span><span style="color: #b9a992;"> */</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">b</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #9c739c;">}</span>;   <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">primi due valori specificati altri inizializzati a 0</span><span style="color: #b9a992;">*/</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">c</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">}</span>;     <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">primo valore specificato altri inizializzati a 0</span><span style="color: #b9a992;">*/</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">d</span><span style="color: #9c739c;">[]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">}</span>;  <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">dimensione dedotta automaticamente</span><span style="color: #b9a992;">*/</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">e</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span>,<span style="color: #465953; background-color: #d2ebe3;">6</span><span style="color: #9c739c;">}</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">error: excess elements in array initializer</span><span style="color: #b9a992;">*/</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">f</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{}</span>;      <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">error: empty initializer</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">return</span>;
<span style="color: #7382a0;">}</span>
</pre>
</div>

<blockquote>
<p>
Sebbene ci siano casi particolari e comportamenti diversi da parte di compilatori diversi, è bene assumere che un array ( o variabili ) non esplicitamente inizializzati contenga valori casuali e quindi inutilizzabili.
</p>
</blockquote>
</div>
</div>

<div id="outline-container-sec-2" class="outline-2">
<h2 id="sec-2"><span class="section-number-2">2</span> Come accedere agli elementi di un array</h2>
<div class="outline-text-2" id="text-2">
<p>
L&rsquo;operatore [ ] permette di accedere agli elementi di un array specificando la posizione a cui vogliamo accedere in lettura o in scrittura.  La prima posizione ha <i>indice 0</i>, mentre l&rsquo;ultima ha indice pari alla dimensione diminuita di 1.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">v</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">}</span>;

<span style="color: #b9a992;">/* </span><span style="color: #b9a992;">accessi in lettura</span><span style="color: #b9a992;"> */</span>
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d"</span>, v<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">primo elemento</span><span style="color: #b9a992;">*/</span>
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d"</span>, v<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">ultimo elemento</span><span style="color: #b9a992;">*/</span>
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d"</span>, v<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">MAI! staimo leggendo una locazione di memoria fuori controllo!</span><span style="color: #b9a992;">*/</span>

<span style="color: #b9a992;">/* </span><span style="color: #b9a992;">accessi in scrittura</span><span style="color: #b9a992;"> */</span>
<span style="color: #605a52; background-color: #f7f3ee;">v</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">]</span> = <span style="color: #465953; background-color: #d2ebe3;">13</span>; <span style="color: #b9a992;">/*</span><span style="color: #b9a992;">primo elemento</span><span style="color: #b9a992;">*/</span>
<span style="color: #605a52; background-color: #f7f3ee;">v</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span> = <span style="color: #465953; background-color: #d2ebe3;">17</span>; <span style="color: #b9a992;">/*</span><span style="color: #b9a992;">ultimo elemento</span><span style="color: #b9a992;">*/</span>
<span style="color: #605a52; background-color: #f7f3ee;">v</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">10</span><span style="color: #7382a0;">]</span> = <span style="color: #465953; background-color: #d2ebe3;">33</span>; <span style="color: #b9a992;">/*</span><span style="color: #b9a992;">MAI! stiamo scrivendo una locazione di memoria fuori controllo!</span><span style="color: #b9a992;">*/</span>

</pre>
</div>

<p>
Output:
</p>
<pre class="example">
1
4
1177202309
</pre>
</div>
</div>

<div id="outline-container-sec-3" class="outline-2">
<h2 id="sec-3"><span class="section-number-2">3</span> Conversione implicita al tipo puntatore</h2>
<div class="outline-text-2" id="text-3">
<p>
Le variabili di tipo array hanno un comportamento diverso dalle altre variabili dei tipi base.
</p>

<p>
<b>L&rsquo;assegnamento non è possibile</b>
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">b</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span>;
b = a; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">error: array type 'int [4]' is not assignable</span><span style="color: #b9a992;">*/</span>
</pre>
</div>

<blockquote>
<p>
<b>Un array di tipo X può essere (anche implicitamente ed automaticamente) convertito ad un tipo puntatore a X, e viceversa.</b>
</p>
</blockquote>

<p>
Questo significa, ad esempio, che possiamo assegnare un array di <b>int</b> ad una variabile di tipo puntatore <b>int*</b>; o, più in generale, possiamo assegnare un array di <b>X</b>, dove <b>X</b> è un tipo qualunque, ad una variabile di tipo puntatore <b>X*</b>.
</p>

<p>
Così come accade per i tipi array, così anche una variabile di tipo puntatore come ad esempio <b>int*</b> supporta l&rsquo;operatore [ ]. In questo caso assumiamo che un array sia presente in memoria a partire dalla locazione memorizzata nel variabile puntatore.
</p>

<p>
Più precisamente, un array convertito ad un puntatore è di fatto un puntatore al primo elemento dell&rsquo;array stesso. Un puntatore supporta l&rsquo;operatore [ ] come se fosse una array memorizzato in memoria a partire dall&rsquo;indirizzo contenuto nella variabili puntatore.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">b</span> = a;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a[0]: %d\n"</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"b[0]: %d\n"</span>, b<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
Output:
</p>
<pre class="example">
a[0]: 1
b[0]: 1
</pre>

<p>
Questa trasformazione accede sempre nel caso dei parametri di una funzione.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">somma</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">v</span><span style="color: #7382a0;">)</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">comput sum of all elements</span><span style="color: #b9a992;"> */</span>
<span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">x</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">5</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">s</span> = somma<span style="color: #7382a0;">(</span>x<span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
La variabile di tipo array <b>x</b> viene implicitamente e correttamente convertita (coercion) in variabile di tipo <b>int*</b>. Il parametro <b>v</b> conterrà l&rsquo;indirizzo di memoria del primo elemento dell&rsquo;array <b>x</b>.
</p>

<blockquote>
<p>
Usando <b>v</b> possiamo modificare gli elementi dell&rsquo;array <b>x</b>, ma non <b>x</b> stesso, ovvero possiamo fare in modo che <b>x</b> punti ad una diversa locazione di memoria.
</p>
</blockquote>

<p>
La conversione implicita viene sempre applicata nel caso dei parametri di una funzione. In particolare le seguenti dichiarazioni di funzione sono tutte equivalenti alla prima. Questa significa, che anche se è possibile dichiarare un parametro come <b>int arr[4]</b> la dimensione 4 viene del tutti ignorata (questo non è vero per array a più dimensioni).
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_0</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">arr</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span><span style="color: #b9a992;">/*</span><span style="color: #b9a992;">...</span><span style="color: #b9a992;">*/</span><span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_1</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">arr</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span><span style="color: #b9a992;">/*</span><span style="color: #b9a992;">...</span><span style="color: #b9a992;">*/</span><span style="color: #7382a0;">}</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">parameter equivalent to int* arr</span><span style="color: #b9a992;"> */</span>
<span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_2</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">arr</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">5</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span><span style="color: #b9a992;">/*</span><span style="color: #b9a992;">...</span><span style="color: #b9a992;">*/</span><span style="color: #7382a0;">}</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">parameter equivalent to int* arr</span><span style="color: #b9a992;"> */</span>
<span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_3</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">arr</span><span style="color: #9c739c;">[]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span><span style="color: #b9a992;">/*</span><span style="color: #b9a992;">...</span><span style="color: #b9a992;">*/</span><span style="color: #7382a0;">}</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">parameter equivalent to int* arr</span><span style="color: #b9a992;">  */</span>
</pre>
</div>

<blockquote>
<p>
<b>BEST PRACTICE</b>: In generale, vorremmo scrivere funzioni che possano manipolare array di dimensione qualsiasi. Quindi è consigliabili usare sempre il tipo <b>int*</b> nella dichiarazione dei parametri.
</p>
</blockquote>

<p>
<b>Da array a puntatori and back</b>
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">b</span> = &amp;a<span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">]</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">c</span> = &amp;a<span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #7382a0;">]</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a[0]: %d\n"</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"b[0]: %d\n"</span>, b<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"c[0]: %d\n"</span>, c<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
Output:
</p>
<pre class="example">
a[0]: 1
b[0]: 1
c[0]: 2
</pre>

<p>
Nella dichiarazione di <b>b</b> stiamo applicando l&rsquo;operatore &amp; al primo elemento dell&rsquo;array <b>a</b>, e come risultato otteniamo quindi l&rsquo;indirizzo di quest&rsquo;ultimo. Essendo <b>b</b> un puntatore, accetta l&rsquo;operatore di accesso [ ].
</p>

<p>
Nella dichiarazione di <b>c</b> stiamo applicando l&rsquo;operatore &amp; al <i>secondo</i> elemento dell&rsquo;array <b>a</b>, e come risultato otteniamo quindi l&rsquo;indirizzo di quest&rsquo;ultimo. Essendo <b>c</b> un puntatore, accetta l&rsquo;operatore di accesso [ ]. Nota che infatti visualizzando <b>c[0]</b> otteniamo il secondo elemento di <b>a</b>. In un certo senso possiamo dire che <b>a,b</b> e <b>c</b> possono essere interpretati come tre array che si sovrappongono.
</p>

<p>
<b>Fine dello scope</b>
</p>

<p>
Cosa succede quanto le variabili <b>a,b</b> e <b>c</b> dell&rsquo;esempio precedente raggiunto la fine dello scope?
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">}</span>;
    <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">b</span> = &amp;a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span>;
    <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">c</span> = &amp;a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #9c739c;">]</span>;
<span style="color: #7382a0;">}</span>
</pre>
</div>

<p>
Non abbiamo tre array ma un array e due puntatori!
</p>

<ul class="org-ul">
<li>La variabile <b>c</b> è di tipo <b>int*</b>, e lo spazio dedicato a questo puntatore viene deallocato.
</li>
<li>Analogamente per la variabile <b>c</b>
</li>
<li>La variabile <b>a</b> è un array di 4 elementi è occupa un numero di locazione di memoria continue necessarie per memorizzare 4 interi (4 x 4 byte). Questa memoria viene de-allocata.
</li>
</ul>
</div>
</div>

<div id="outline-container-sec-4" class="outline-2">
<h2 id="sec-4"><span class="section-number-2">4</span> Aritmetica dei puntatori</h2>
<div class="outline-text-2" id="text-4">
<p>
Il linguaggio supporta operazioni aritmetiche sui puntatori con significato speifico.
</p>
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">b</span> = a + <span style="color: #465953; background-color: #d2ebe3;">1</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">c</span> = b - <span style="color: #465953; background-color: #d2ebe3;">1</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a[0]: %d\n"</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"b[0]: %d\n"</span>, b<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"c[0]: %d\n"</span>, c<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
Output:
</p>
<pre class="example">
a[0]: 1
b[0]: 2
c[0]: 1
</pre>

<p>
Nel codice sopra, l&rsquo;espressione <b>a + 1</b> esegue una banale operazioni aritmetica ma invece di sommare 1 all&rsquo;indirizzo del primo elemento di <b>a</b> (conversione automatica da array a puntatore), il valore sommato e&rsquo; pari alla dimensione del tipo degli elementi dell&rsquo;array <b>a</b>.
Quindi <b>a + 1</b> e&rsquo; di tipo <b>int*</b> ed e&rsquo; pari all&rsquo;indirizzo del secondo elemento dell&rsquo;array <b>a</b>.
</p>

<p>
Analogamente per la variabile <b>c</b>.
</p>

<p>
Abbiamo visto che se <b>a</b> e&rsquo; un array le seguenti espressioni sono equivalenti:
</p>

<ul class="org-ul">
<li><b>&amp;a[1]</b>
</li>
<li><b>a + 1</b> in entrambi i casi l&rsquo;espressione viene valutata in un puntatore di tipppo <b>int*</b> corrispondente all&rsquo;indirizzo del secondo elemento dell&rsquo;array <b>a</b>.
</li>
</ul>

<p>
Ad un puntatore possiamo sempre applicare l&rsquo;operatore di dereferenziazione *, ottenendo due espressioni equivalenti:
</p>
<ul class="org-ul">
<li><b>*&amp;a[1]</b>
</li>
<li><b>*(a + 1)</b>
</li>
</ul>

<p>
Entrambe le espressioni sono valide e &ldquo;producono&rdquo; il valore contenuto nella seconda posizione dell&rsquo;array <b>a</b>. Non vi capitera&rsquo; mai di incontrare o di usare la prima espressione. La seconda espressione e&rsquo; invece molto piu&rsquo; comune. In particolare, dato un intero <b>i</b>, le espressioni <b>a[ i ]</b> e <b>*(a + 1)</b> sono equivalenti.
</p>

<p>
Nota il codice seguente, dove queste espressioni sono usate per un accesso in scrittura.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #7382a0;">[]</span>  = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">a</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">]</span>     = <span style="color: #465953; background-color: #d2ebe3;">101</span>;
*<span style="color: #7382a0;">(</span>a + <span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #7382a0;">)</span> = <span style="color: #465953; background-color: #d2ebe3;">102</span>;
<span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #7382a0;">[</span>a<span style="color: #7382a0;">]</span>     = <span style="color: #465953; background-color: #d2ebe3;">103</span>;
printf<span style="color: #7382a0;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a: %d %d %d\n"</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #9c739c;">]</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #9c739c;">]</span>, a<span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
Output:
</p>
<pre class="example">
a: 101 102 103
</pre>
<p>
Infine, la differenza tra due puntatori dello stesso tipo produce il numero di elementi tra i due pontatori.
</p>
</div>
</div>


<div id="outline-container-sec-5" class="outline-2">
<h2 id="sec-5"><span class="section-number-2">5</span> Iterare gli elementi di un array</h2>
<div class="outline-text-2" id="text-5">
<p>
Sotto, due funzioni che calcolano la somma degli elementi di un array. Poichè, come detto l’informazione delle lunghezza dell’array viene “persa” nella chiamata di funzione, è necessario un parametro aggiuntivo: nel primo caso un intero con la dimensione dell’array, mentre nel secondo abbiamo una sentinella che punta subito dopo la fine del vettore. Entrambi i meccanismi sono ugualmente validi e molto comuni. (Il secondo meccanismo sarà frequente con l’uso degli iteratori in C++)
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">#include</span> <span style="color: #7382a0; background-color: #e2e9c1;">&lt;</span><span style="color: #525643; background-color: #e2e9c1;">stdio.h</span><span style="color: #7382a0; background-color: #e2e9c1;">&gt;</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">sum_size</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">v</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">v_size</span><span style="color: #7382a0;">)</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">i</span>;      <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">indice di posizione</span><span style="color: #b9a992;"> */</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">sum</span> = <span style="color: #465953; background-color: #d2ebe3;">0</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">for</span><span style="color: #9c739c;">(</span>i = <span style="color: #465953; background-color: #d2ebe3;">0</span>; i &lt; v_size; ++i<span style="color: #9c739c;">)</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">itera l'indice da 0 a v_size (escluso)</span><span style="color: #b9a992;"> */</span>
        sum += v<span style="color: #9c739c;">[</span>i<span style="color: #9c739c;">]</span>;            <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">accedi all'elemento i-esimo</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">return</span> sum;
<span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">sum_sentinel</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">v_begin</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">v_end</span><span style="color: #7382a0;">)</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">v</span>;     <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">puntatore ad intero</span><span style="color: #b9a992;"> */</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">sum</span> = <span style="color: #465953; background-color: #d2ebe3;">0</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">for</span><span style="color: #9c739c;">(</span>v = v_begin; v != v_end; ++v<span style="color: #9c739c;">)</span>   <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">sposta il puntatore dall'inizio alla fine (esclusa)</span><span style="color: #b9a992;"> */</span>
        sum += *v;            <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">dereferenzia</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">return</span> sum;
<span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">main</span><span style="color: #7382a0;">()</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #9c739c;">[]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">}</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"sum_size: %d\n"</span>, sum_size<span style="color: #81895d;">(</span>a,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #81895d;">)</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"sum_sentinel: %d\n"</span>, sum_sentinel<span style="color: #81895d;">(</span>a, a + <span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #81895d;">)</span><span style="color: #9c739c;">)</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">return</span> <span style="color: #465953; background-color: #d2ebe3;">0</span>;
<span style="color: #7382a0;">}</span>
</pre>
</div>

<table class="table table-striped table-bordered table-hover table-condensed">


<colgroup>
<col  class="left">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="text-left">sum_size:</td>
<td class="text-right">10</td>
</tr>

<tr>
<td class="text-left">sum_sentinel:</td>
<td class="text-right">10</td>
</tr>
</tbody>
</table>
</div>
</div>

<div id="outline-container-sec-6" class="outline-2">
<h2 id="sec-6"><span class="section-number-2">6</span> Memoria Dinamica</h2>
<div class="outline-text-2" id="text-6">
<p>
Nella maggior parte della applicazioni reali non siamo in grado di prevedere la dimensione necessaria per un array al momento della progettazione del codice. Dobbiamo essere in grado di “creare” nuova memoria quando necessario.
</p>

<p>
Il linguaggio mette alcune funzioni per poter <b>allocare</b> nuova memoria
Tra queste:
</p>

<ul class="org-ul">
<li><b>void*</b> <b>malloc(size_t size)</b> restituisce un puntatore ad una nuova area di memoria valida grande <b>size</b> bytes, o 0 in caso di errore (es. memoria insufficiente)
</li>
<li><b>void*</b> <b>calloc(size_t num, size_t size)</b>, come sopra, sta volta la dimensione è pari a <b>num x size</b>, e viene inizializzato a 0.
</li>
</ul>

<p>
Nota:
</p>
<blockquote>
<ul class="org-ul">
<li>Le funzioni ritornano un generico puntatore void* che deve quindi essere convertito al tipo di interesse
</li>
<li><b>size_t</b> è il tipo intero senza segno sufficientemente grande da memorizzare la più grande dimensione possibile di un oggetto in memoria; sarebbe buona prassi usare il tipo <b>size_t</b> anche per gli indici di accesso agli array;
</li>
<li>è possibile “chiedere” la dimensione di un tipo usando la funzione <b>sizeof</b> ,es. <b>sizeof(int)</b>;
</li>
<li>In caso di fallimento, la gestione è lasciata al programmatore, es. exit (1) termina il programma con codice di errore 1 (0 significa esecuzione con successo).
</li>
</ul>
</blockquote>

<p>
La figuta che segue illustra l&rsquo;uso della memoria:
</p>
<ul class="org-ul">
<li>Lo <b>Stack</b> include tutte le variabili viste fino ad ora, es. dichiarazioni e parametri
</li>
<li>Lo <b>Heap</b> include le variabili allocate dinamicamente
</li>
<li>Il segmento <b>Text</b> contiene il programma stesso
</li>
<li>L&rsquo;indirizzo 0 non è mai utilizzato.
</li>
</ul>

<figure>
<p><img src="../img/info/memory.png" class="img-responsive" alt="memory.png">
</p>
</figure>

<p>
Mentre l’uso corretto dello Stack è garantito in maniera automatica allocando e deallocando memoria
ad ogni activation record / chiamata di funzione, la gestione dello Heap è lasciata al programmatore
che deve deallocare, durante il programma e prima della terminazione, la memoria non più utilizzata
(altrimenti si verificherebbe un memory leak).
</p>

<p>
La deallocazione avviene tramite la chiamata alla funzione <b>free</b>:
</p>
<ul class="org-ul">
<li><b>void free(void*</b> <b>ptr)</b>
</li>
</ul>

<p>
Per una corretta gestione della memoria è importante chiarire nella documentazione del nostro
codice la ownership della memoria allocata. Distinguiamo due meccanismi comuni:
</p>

<ul class="org-ul">
<li><i>Callee allocated and returned</i>. La funzione chiamata alloca la memoria e restituisce un puntatore al chiamante, che diventa responsabile per la sua de‐allocazione.
</li>
<li><i>Caller ownership</i>. Il chiamante è responsabile di allocare e de‐allocare memoria; può passare alla funzione chiamata un puntatore che può essere usato per modificarne il contenuto.
</li>
</ul>
</div>

<div id="outline-container-sec-6-1" class="outline-3">
<h3 id="sec-6-1"><span class="section-number-3">6.1</span> Esercizio: Scrivere una funzione che dato un vettore, genera un nuovo vettore con gli stessi elementi in ordine inverso.</h3>
<div class="outline-text-3" id="text-6-1">
<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">#include</span> <span style="color: #7382a0; background-color: #e2e9c1;">&lt;</span><span style="color: #525643; background-color: #e2e9c1;">stdlib.h</span><span style="color: #7382a0; background-color: #e2e9c1;">&gt;</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">needed for dynamic memory</span><span style="color: #b9a992;"> */</span>
<span style="color: #605a52; background-color: #f7f3ee;">#include</span> <span style="color: #7382a0; background-color: #e2e9c1;">&lt;</span><span style="color: #525643; background-color: #e2e9c1;">stdio.h</span><span style="color: #7382a0; background-color: #e2e9c1;">&gt;</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #605a52;">reversed_callee</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">src</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">src_size</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">i</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">memory allocation</span><span style="color: #b9a992;"> */</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">dest</span> = <span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #9c739c;">)</span> malloc<span style="color: #9c739c;">(</span><span style="color: #614c61; background-color: #f1ddf1;">sizeof</span><span style="color: #81895d;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span><span style="color: #81895d;">)</span> * src_size<span style="color: #9c739c;">)</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">if</span> <span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">!</span>dest<span style="color: #9c739c;">)</span>
        <span style="color: #614c61; background-color: #f1ddf1;">return</span> <span style="color: #465953; background-color: #d2ebe3;">0</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">return bad pointer</span><span style="color: #b9a992;"> */</span>
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">reverse</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">for</span> <span style="color: #9c739c;">(</span>i=<span style="color: #465953; background-color: #d2ebe3;">0</span>; i &lt; src_size; i++<span style="color: #9c739c;">)</span>
        dest<span style="color: #9c739c;">[</span>src_size - i - <span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #9c739c;">]</span> = src<span style="color: #9c739c;">[</span>i<span style="color: #9c739c;">]</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">return array</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">return</span> dest;
<span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">reversed_caller</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">src</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">src_size</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">dest</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">i</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">reverse</span><span style="color: #b9a992;"> */</span>
    <span style="color: #614c61; background-color: #f1ddf1;">for</span> <span style="color: #9c739c;">(</span>i=<span style="color: #465953; background-color: #d2ebe3;">0</span>; i &lt; src_size; i++<span style="color: #9c739c;">)</span>
        dest<span style="color: #9c739c;">[</span>src_size - i - <span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #9c739c;">]</span> = src<span style="color: #9c739c;">[</span>i<span style="color: #9c739c;">]</span>;
<span style="color: #7382a0;">}</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">main</span><span style="color: #7382a0;">()</span> <span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span><span style="color: #9c739c;">[]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">}</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">initial array</span><span style="color: #b9a992;"> */</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">a_rev</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">pointer for reversed array</span><span style="color: #b9a992;"> */</span>
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">callee</span><span style="color: #b9a992;"> */</span>
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"---- Callee\n"</span><span style="color: #9c739c;">)</span>;
    a_rev = reversed_callee<span style="color: #9c739c;">(</span>a, <span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">)</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">if</span><span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">!</span>a_rev<span style="color: #9c739c;">){</span> <span style="color: #b9a992;">/*</span><span style="color: #b9a992;">failureincalledfunction</span><span style="color: #b9a992;">*/</span>
        printf<span style="color: #81895d;">(</span><span style="color: #525643; background-color: #e2e9c1;">"Fatal error!"</span><span style="color: #81895d;">)</span>;
        exit<span style="color: #81895d;">(</span><span style="color: #465953; background-color: #d2ebe3;">EXIT_FAILURE</span><span style="color: #81895d;">)</span>; <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">immediate exit, EXIT_FAILURE is a macro for value 1</span><span style="color: #b9a992;"> */</span>
    <span style="color: #9c739c;">}</span>

    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a: %d %d %d %d\n"</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #81895d;">]</span> <span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a_rev: %d %d %d %d\n"</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #81895d;">]</span> <span style="color: #9c739c;">)</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">ALWAYS remember to deallocate memory</span><span style="color: #b9a992;"> */</span>
    free<span style="color: #9c739c;">(</span>a_rev<span style="color: #9c739c;">)</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">caller</span><span style="color: #b9a992;"> */</span>
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"---- Caller\n"</span><span style="color: #9c739c;">)</span>;
    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">pre-allocate necessary memory</span><span style="color: #b9a992;"> */</span>
    a_rev = <span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #9c739c;">)</span> malloc<span style="color: #9c739c;">(</span><span style="color: #614c61; background-color: #f1ddf1;">sizeof</span><span style="color: #81895d;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span><span style="color: #81895d;">)</span> * <span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #9c739c;">)</span>;
    <span style="color: #614c61; background-color: #f1ddf1;">if</span> <span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">!</span>a_rev<span style="color: #9c739c;">)</span> <span style="color: #9c739c;">{</span>
        printf<span style="color: #81895d;">(</span><span style="color: #525643; background-color: #e2e9c1;">"Fatal error!"</span><span style="color: #81895d;">)</span>;
        exit<span style="color: #81895d;">(</span><span style="color: #465953; background-color: #d2ebe3;">EXIT_FAILURE</span><span style="color: #81895d;">)</span>;
    <span style="color: #9c739c;">}</span>

    reversed_caller<span style="color: #9c739c;">(</span>a, <span style="color: #465953; background-color: #d2ebe3;">4</span>, a_rev<span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a: %d %d %d %d\n"</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span>, a<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #81895d;">]</span> <span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"a_rev: %d %d %d %d\n"</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span>, a_rev<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #81895d;">]</span> <span style="color: #9c739c;">)</span>;

    <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">ALWAYS remember to deallocate memory</span><span style="color: #b9a992;"> */</span>
    free<span style="color: #9c739c;">(</span>a_rev<span style="color: #9c739c;">)</span>; <span style="color: #614c61; background-color: #f1ddf1;">return</span> <span style="color: #465953; background-color: #d2ebe3;">0</span>;
<span style="color: #7382a0;">}</span>
</pre>
</div>

<table class="table table-striped table-bordered table-hover table-condensed">


<colgroup>
<col  class="left">

<col  class="right">

<col  class="right">

<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="text-left">----</td>
<td class="text-right">Callee</td>
<td class="text-right">&#xa0;</td>
<td class="text-right">&#xa0;</td>
<td class="text-right">&#xa0;</td>
</tr>

<tr>
<td class="text-left">a:</td>
<td class="text-right">1</td>
<td class="text-right">2</td>
<td class="text-right">3</td>
<td class="text-right">4</td>
</tr>

<tr>
<td class="text-left">a_rev:</td>
<td class="text-right">4</td>
<td class="text-right">3</td>
<td class="text-right">2</td>
<td class="text-right">1</td>
</tr>

<tr>
<td class="text-left">----</td>
<td class="text-right">Caller</td>
<td class="text-right">&#xa0;</td>
<td class="text-right">&#xa0;</td>
<td class="text-right">&#xa0;</td>
</tr>

<tr>
<td class="text-left">a:</td>
<td class="text-right">1</td>
<td class="text-right">2</td>
<td class="text-right">3</td>
<td class="text-right">4</td>
</tr>

<tr>
<td class="text-left">a_rev:</td>
<td class="text-right">4</td>
<td class="text-right">3</td>
<td class="text-right">2</td>
<td class="text-right">1</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>

<div id="outline-container-sec-7" class="outline-2">
<h2 id="sec-7"><span class="section-number-2">7</span> Array Multi-dimensionale</h2>
<div class="outline-text-2" id="text-7">
<p>
Il linguaggio C consente di creare array a più dimensioni, ad esempio per rappresentare una matrice quadrata, o un’immagine con i tre canali rosso, verde, blu. L’inizializzazione è simile a quella degli array unidimensionali.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">matrice</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #7382a0;">]</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">immagine</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">64</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">64</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m_init</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span>,<span style="color: #465953; background-color: #d2ebe3;">6</span><span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m_init_better</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span> <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">}</span>,<span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span>,<span style="color: #465953; background-color: #d2ebe3;">6</span><span style="color: #9c739c;">}</span> <span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m_init_missing</span><span style="color: #7382a0;">[][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span> <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">}</span>,<span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span>,<span style="color: #465953; background-color: #d2ebe3;">6</span><span style="color: #9c739c;">}</span> <span style="color: #7382a0;">}</span>;
<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m_init_partial</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">{</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">}</span>;
</pre>
</div>

<p>
L’uso delle parentesi quadre multiple fa riferimento alle diverse dimensioni, ad esempio matrice ha 2 righe e 3 colonne. Lo stesso meccanismo si può usare per accedere in lettura e in scrittura.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">a</span> = matrice<span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #7382a0;">]</span>;
<span style="color: #605a52; background-color: #f7f3ee;">matrice</span><span style="color: #7382a0;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #7382a0;">][</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #7382a0;">]</span> = <span style="color: #465953; background-color: #d2ebe3;">55</span>;
</pre>
</div>

<p>
<b>Qual è la configurazione in memoria di un array multi‐dimensionale?</b>
</p>

<p>
Consideriamo il codice seguente. Usiamo una variabile ausiliaria <b>int*</b> <b>m</b>, per memorizzare l’indirizzo del primo elemento della matrice, e poi visualizziamo 6 elementi consecutivi a partire da questo e contemporaneament 6 elementi della matrice usanto l’indicizzazione per riga e colonna.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">#include</span> <span style="color: #7382a0; background-color: #e2e9c1;">&lt;</span><span style="color: #525643; background-color: #e2e9c1;">stdio.h</span><span style="color: #7382a0; background-color: #e2e9c1;">&gt;</span>

<span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #605a52;">main</span><span style="color: #7382a0;">()</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">matrice</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #9c739c;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span> = <span style="color: #9c739c;">{</span><span style="color: #465953; background-color: #d2ebe3;">1</span>,<span style="color: #465953; background-color: #d2ebe3;">2</span>,<span style="color: #465953; background-color: #d2ebe3;">3</span>,<span style="color: #465953; background-color: #d2ebe3;">4</span>,<span style="color: #465953; background-color: #d2ebe3;">5</span>,<span style="color: #465953; background-color: #d2ebe3;">6</span><span style="color: #9c739c;">}</span>;
    <span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">m</span> = <span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #9c739c;">)</span> &amp;<span style="color: #9c739c;">(</span>matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">0</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">4</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;
    printf<span style="color: #9c739c;">(</span><span style="color: #525643; background-color: #e2e9c1;">"%d %d\n"</span>, m<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">5</span><span style="color: #81895d;">]</span>, matrice<span style="color: #81895d;">[</span><span style="color: #465953; background-color: #d2ebe3;">1</span><span style="color: #81895d;">][</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #81895d;">]</span><span style="color: #9c739c;">)</span>;

    <span style="color: #614c61; background-color: #f1ddf1;">return</span> <span style="color: #465953; background-color: #d2ebe3;">0</span>;
<span style="color: #7382a0;">}</span>
</pre>
</div>

<table class="table table-striped table-bordered table-hover table-condensed">


<colgroup>
<col  class="right">

<col  class="right">
</colgroup>
<tbody>
<tr>
<td class="text-right">1</td>
<td class="text-right">1</td>
</tr>

<tr>
<td class="text-right">2</td>
<td class="text-right">2</td>
</tr>

<tr>
<td class="text-right">3</td>
<td class="text-right">3</td>
</tr>

<tr>
<td class="text-right">4</td>
<td class="text-right">4</td>
</tr>

<tr>
<td class="text-right">5</td>
<td class="text-right">5</td>
</tr>

<tr>
<td class="text-right">6</td>
<td class="text-right">6</td>
</tr>
</tbody>
</table>


<p>
Appare chiaro come anche gli elementi di un array multidimensionale siano memorizzati in locazioni di memoria adiacenti. In particolare, abbiamo prima tutti gli elementi della prima riga e poi tutti gli elementi della seconda riga. Questo layout viene comunemente denominato <b>row‐wise</b>, e non possiamo scegliere layout diversi.
</p>

<p>
<b>Matrici come parametri di funzione</b>
</p>

<p>
il tipo della metrice <b>int matrice[ 2 ][ 3 ]</b> è <b>int (*</b> <b>)[ 3 ]</b> con il seguente significato:
</p>
<ul class="org-ul">
<li>Il numero di righe viene “dimenticato” così come dimentichiamo la lunghezza degli array unidimensionali
</li>
<li>La matrice è organizzata in righe di 3 colonne.
</li>
</ul>

<p>
La spiegazione è che il compilatore memorizza la minima informazione sufficiente per supportare le operazioni di accesso ad una qualsiasi riga \(i\) e colonna \(j\).
</p>

<ul class="org-ul">
<li>Accedere alla <b>matrice[ i ][ j ]</b> significa accedere alla locazione di memoria in posizione \(3 \cdot i + j\) a partire dal primo elemento della matrice.
</li>
</ul>

<p>
In analogia a quanto visto per gli array unidimensionali, le seguenti funzioni sono del tutto equivalenti. La prima di queste 4 opzioni è la più comune.
</p>
<div class="org-src-container">

<pre class="src src-C"> <span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_0</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">intm</span><span style="color: #9c739c;">[][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span><span style="color: #b9a992;">/*</span><span style="color: #b9a992;">...</span><span style="color: #b9a992;">*/</span><span style="color: #7382a0;">}</span>
 <span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_1</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">2</span><span style="color: #9c739c;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">...</span><span style="color: #b9a992;"> */</span> <span style="color: #7382a0;">}</span>
 <span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_2</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">m</span><span style="color: #9c739c;">[</span><span style="color: #465953; background-color: #d2ebe3;">10</span><span style="color: #9c739c;">][</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">...</span><span style="color: #b9a992;"> */</span> <span style="color: #7382a0;">}</span>
 <span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun_3</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #9c739c;">(</span>*<span style="color: #4c5361; background-color: #dde4f2;">m</span><span style="color: #9c739c;">)[</span><span style="color: #465953; background-color: #d2ebe3;">3</span><span style="color: #9c739c;">]</span><span style="color: #7382a0;">)</span> <span style="color: #7382a0;">{</span> <span style="color: #b9a992;">/* </span><span style="color: #b9a992;">...</span><span style="color: #b9a992;"> */</span> <span style="color: #7382a0;">}</span>
</pre>
</div>

<p>
Questo nuovo modo di dichiarare un parametro di funzioni ( <b>int(<b>arr</b></b>)[COLS]*, omettiamo le righe) si estende anche a matrici con un maggior numero di dimensioni (in 3D int (<b>arr)[HEIGHT][DEPTH] omettiamo l’altezza), e viene denominato *adjustable array</b>, dove è la prima dimensione che si intende <b>adjustable</b>.
</p>

<p>
In generale, la nostra funzione potrebbe non conoscere né il numero di righe né il numero di colonne della matrice in input. In questo caso le dimensioni della matrice vanno esplicitate e l’accesso gestito dal programmatore.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">void</span> <span style="color: #605a52;">fun</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span> *<span style="color: #4c5361; background-color: #dde4f2;">m</span>, <span style="color: #605a52; background-color: #f7f3ee;">int</span> <span style="color: #4c5361; background-color: #dde4f2;">COLS</span><span style="color: #7382a0;">)</span>
<span style="color: #7382a0;">{</span>
    <span style="color: #b9a992;">/*</span><span style="color: #b9a992;">accesstorowiandcolj</span><span style="color: #b9a992;">*/</span>
    ... m<span style="color: #9c739c;">[</span>i*<span style="color: #465953; background-color: #d2ebe3;">COLS</span> + j<span style="color: #9c739c;">]</span> ... <span style="color: #465953; background-color: #d2ebe3;">4</span>
<span style="color: #7382a0;">}</span>
</pre>
</div>


<p>
Nota che la variabile di tipo int* non può supportare il doppio uso delle quadre come per le matrici. Possiamo invece dire che il doppio uso per le quadre in array multi‐dimensionali corrisponde al calcolo di un offset (es. \(i \cdot cols + j\) ) rispetto alla locazione in memoria del primo elemento della matrice.
</p>

<p>
<b>Allocazione Dinamica</b>
</p>

<p>
Come possiamo creare un array bidimensionale quando non ne conosciamo a priori la dimensione?
</p>

<p>
Dobbiamo allocare dinamicamente la memoria come fatto per gli array unidimensionali, e usare l’ultimo meccanismo visto sopra per accedere ai suoi elementi.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span>* <span style="color: #4c5361; background-color: #dde4f2;">m</span> = <span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #7382a0;">)</span> <span style="color: #605a52;">malloc</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">rows</span> * <span style="color: #605a52;">cols</span> * <span style="color: #614c61; background-color: #f1ddf1;">sizeof</span><span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span><span style="color: #9c739c;">)</span><span style="color: #7382a0;">)</span>;
...
... m<span style="color: #7382a0;">[</span>i*cols + j<span style="color: #7382a0;">]</span> ...
</pre>
</div>

<p>
Questo meccanismo ha il vantaggio di usare locazioni di memoria continue, e, in termini di semplicità
del codice, una sola malloc e una sola free.
</p>

<p>
Da non confondere con quello che comunemente viene detto <b>array di array</b>. Vediamo il codice
seguente.
</p>

<div class="org-src-container">

<pre class="src src-C"><span style="color: #605a52; background-color: #f7f3ee;">int</span> **<span style="color: #4c5361; background-color: #dde4f2;">m</span> = <span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>**<span style="color: #7382a0;">)</span> <span style="color: #605a52;">malloc</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">rows</span> * <span style="color: #614c61; background-color: #f1ddf1;">sizeof</span><span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #9c739c;">)</span><span style="color: #7382a0;">)</span>;
<span style="color: #614c61; background-color: #f1ddf1;">for</span> <span style="color: #7382a0;">(</span>i=<span style="color: #465953; background-color: #d2ebe3;">0</span>; i&lt;rows, i++<span style="color: #7382a0;">)</span>
    <span style="color: #605a52; background-color: #f7f3ee;">m</span><span style="color: #7382a0;">[</span>i<span style="color: #7382a0;">]</span> = <span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span>*<span style="color: #7382a0;">)</span> <span style="color: #605a52;">malloc</span><span style="color: #7382a0;">(</span><span style="color: #605a52; background-color: #f7f3ee;">cols</span> * <span style="color: #614c61; background-color: #f1ddf1;">sizeof</span><span style="color: #9c739c;">(</span><span style="color: #605a52; background-color: #f7f3ee;">int</span><span style="color: #9c739c;">)</span><span style="color: #7382a0;">)</span>;
</pre>
</div>

<p>
Stiamo usando un meccanismo di <i>doppia indirezione</i>: puntatori di puntatori. Spieghiamo il codice in ordine inverso, dall’ultima riga alla prima:
</p>

<ul class="org-ul">
<li>m[ i ] memorizza il risultato di una malloc, e quindi contiene un puntatore ad array che ha tanti elementi quante le colonne della matrice desiderata. m[ i ] è quindi un puntatore a intero di tipo <b>int*</b> associato ad una riga della matrice;
</li>
<li>Vogliamo tanti di questi vettori quante le righe della nostra matrice, quindi ripetiamo l’allocazione per ciascuna riga
</li>
<li>Ciascun puntatore alla riga appena allocata viene memorizzato in un <b>array m</b>. L’*array m* sarà di tipo puntatore al valore dei suoi singoli elementi, i suoi elementi sono di tipo <b>int*</b>, qundi <b>m</b> deve essere di tipo <b>int**</b>
</li>
</ul>

<p>
Nella figura sotto una rappresentazione di quanto prodotto dal codice
<img src="../img/info/arr.png" class="img-responsive" alt="arr.png">
</p>


<p>
Questo meccanismo supporta l’accesso agli elementi della matrice con l’uso delle quadre <b>m[ i ][ j ]</b>,
ma con un significato completamente diverso:
</p>
<ul class="org-ul">
<li><b>m</b> non è di tipo array bidimensionale <b>int (*</b> <b>)[cols]</b>, quindi il doppio uso delle quadre non è un calcolo di un offset è l’accesso alla matrice.
</li>
<li>Prima viene valutato <b>m[ i ]</b>, ovvero l’i‐esimo elemento dell’*array m* che contiene un puntatore alla righa i‐esima della matrice, e quindi contiene un <b>int*</b>
</li>
<li><b>m[ i ][ j ]</b> accede al j‐esimo elemento della riga i‐esima.
</li>
</ul>


<p>
Questo meccasimo è utile solo quando non abbiamo a che fare con una vera matrice, o quando la matrice è molto sparsa ovvero piena di zeri che non vogliamo memorizzare per risparmiare memoria. In questo caso si usa a volte il termine di <b>matrice frastagliata</b>.
</p>


<p>
<a href="#sec-1">[ TOP ]​</a> <a href="ITlist.html">[ HOME ]​</a>
</p>
</div>
</div>
</div></div></div>
<footer id="postamble" class="">
<div><p class="author">Author: Jacopo Costantini</p>
<p class="date">Created: 2022-01-21 Fri 12:48</p>
<p class="creator"><a href="http://www.gnu.org/software/emacs/">Emacs</a> 28.0.91 (<a href="http://orgmode.org">Org-mode</a> 9.6)</p>
</div>
</footer>
</body>
</html>
